import{A as N,o as T,B as L,r as y,C as O,e as w,j as o,S as R,F as k,D as q}from"./index-2c25cc0e.js";import{c as E}from"./calorieUtilService-74544aa9.js";import{E as x}from"./ErrorMsg-db1c1bb2.js";function A({startDate:l,endDate:t}){const u=["days",l.toISOString(),t.toISOString()],{data:h,error:D,isLoading:S,isSuccess:m,isError:f}=N({queryKey:[u],queryFn:()=>{const _={"date[gte]":l.toISOString(),"date[lte]":t.toISOString()};return T.query(_)}}),p=!!h&&h.length===0;return{days:h,error:D,isLoading:S,isSuccess:m,isError:f,isEmpty:p}}const b=()=>{const{loggedInUser:l}=L(n=>n.auth),[t,u]=y.useState(new Date),{allDays:h,startDate:D,endDate:S}=I(),{days:m,isLoading:f,isSuccess:p,isError:_}=A({startDate:D,endDate:S}),C=y.useRef(null);y.useEffect(()=>{const n=r=>{const c=r.touches[0];M.current=c.clientX},e=r=>{const a=r.changedTouches[0].clientX,d=25;if(a-M.current>d){const i=new Date(t);i.setMonth(t.getMonth()-1),u(i)}else if(M.current-a>d){const i=new Date(t);i.setMonth(t.getMonth()+1),u(i)}},s=C.current;return s&&(s.addEventListener("touchstart",n,!1),s.addEventListener("touchend",e,!1)),()=>{s&&(s.removeEventListener("touchstart",n),s.removeEventListener("touchend",e))}},[t]);const M=y.useRef(0),v=m?h.map(n=>{const e=m.find(c=>{const a=new Date(c.date);return a.getDate()===n.getDate()&&a.getMonth()===n.getMonth()}),s=E.getTotalCalories(e),r=e&&l?E.getBcgByCosumedCalories({consumedCalories:s,targetCalorie:l==null?void 0:l.targetCaloricIntakePerDay}):"";return{id:(e==null?void 0:e.id)||"",backgroundColor:r,date:n.toISOString().split("T")[0],day:n.getDate(),consumedCalories:s}}):[];function I(){const n=O(t.getMonth()+1,t.getFullYear()),e=Array.from({length:n-1},(i,g)=>new Date(t.getFullYear(),t.getMonth(),g+1)),s=e[0].getDay(),r=e[e.length-1].getDay(),c=Array.from({length:s},(i,g)=>new Date(t.getFullYear(),t.getMonth(),g-s+1)),a=Array.from({length:6-r},(i,g)=>new Date(t.getFullYear(),t.getMonth()+1,g+1)),d=[...c,...e,...a];return{allDays:d,startDate:d[0],endDate:d[d.length-1]}}function F(n){const{value:e}=n.target,s=new Date(e);u(s)}return w("section",{className:"schedule-grid-wrapper",children:[f&&o(R,{}),_&&o(x,{}),p&&w(k,{children:[o("input",{type:"date",className:"schedule-grid__date-input",name:"date",value:t.toISOString().split("T")[0],onChange:F}),o("ul",{className:"schedule-grid",ref:C,children:v.map((n,e)=>{const{backgroundColor:s,date:r}=n,c=n.backgroundColor?"white":"",a=e<7;return o("li",{className:"schedule-grid__item",style:{backgroundColor:s,color:c},children:w("div",{className:"schedule-grid__item__link",children:[a&&o("h3",{className:"schedule-grid__item__title",children:q[e].short}),o("h3",{className:"schedule-grid__item__title",children:n.day})]})},r)})})]})]})};const Y=()=>o("main",{className:"schedule-page",children:o(b,{})});export{Y as default};
